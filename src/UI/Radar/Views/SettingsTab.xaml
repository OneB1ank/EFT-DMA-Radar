<UserControl x:Class="LoneEftDmaRadar.UI.Radar.Views.SettingsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:LoneEftDmaRadar.UI.Radar.Views"
             xmlns:vm="clr-namespace:LoneEftDmaRadar.UI.Radar.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Padding="10">

    <d:UserControl.DataContext>
        <d:DesignInstance Type="{x:Type vm:SettingsViewModel}"
                          IsDesignTimeCreatable="False" />
    </d:UserControl.DataContext>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Orientation="Vertical"
                    Margin="0,0,0,10">
            <!-- Radar Settings -->
            <GroupBox Header="雷达设置"
                      Margin="0,0,0,12">
                <StackPanel>

                    <!-- help text -->
                    <TextBlock TextWrapping="Wrap"
                               Margin="0,0,0,12"
                               FontStyle="Italic">
放大: F1 / 鼠标滚轮向上<LineBreak />
缩小: F2 / 鼠标滚轮向下<LineBreak />
切换全屏: F11
                    </TextBlock>

                    <!-- buttons -->
                    <WrapPanel Margin="0,0,0,12">
                        <Button Content="重启雷达"
                                ToolTip="为当前突袭实例重启雷达。如果卡在 '等待突袭开始' 或突袭未正常工作时可能有用。"
                                Command="{Binding RestartRadarCommand}"
                                MinWidth="100"
                                Height="35"
                                Margin="0,0,8,8" />
                        <Button Content="颜色选择器"
                                ToolTip="允许自定义雷达 UI 上实体的颜色。"
                                IsEnabled="{Binding ColorPickerIsEnabled}"
                                Command="{Binding OpenColorPickerCommand}"
                                MinWidth="100"
                                Height="35"
                                Margin="0,0,8,8" />
                        <Button Content="打开配置文件夹"
                                ToolTip="打开配置文件夹。"
                                Command="{Binding OpenConfigCommand}"
                                MinWidth="100"
                                Height="35"
                                Margin="0,0,8,8" />
                        <Button Content="备份配置"
                                ToolTip="备份您的配置（推荐）。"
                                Command="{Binding BackupConfigCommand}"
                                MinWidth="100"
                                Height="35"
                                Margin="0,0,8,8" />
                    </WrapPanel>

                    <!-- sliders -->
                    <WrapPanel Margin="0,0,0,12">
                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="0,0,16,8">
                            <TextBlock Text="界面缩放"
                                       VerticalAlignment="Center"
                                       ToolTip="设置雷达/用户界面的缩放系数。对于高分辨率显示器您可能想增加此值。" />
                            <Slider x:Name="UIScaleSlider"
                                    Width="150"
                                    Margin="8,0"
                                    Minimum="0.5"
                                    Maximum="2.0"
                                    SmallChange="0.01"
                                    LargeChange="0.1"
                                    Value="{Binding UIScale, Mode=TwoWay}" />
                            <TextBlock Text="{Binding Value, ElementName=UIScaleSlider, StringFormat=F2}"
                                       VerticalAlignment="Center"
                                       Margin="8,0,0,0" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="0,0,16,8">
                            <TextBlock Text="雷达最大FPS (0 = 无限)"
                                       VerticalAlignment="Center" />
                            <Slider x:Name="RadarFpsSlider"
                                    Width="180"
                                    Margin="8,0"
                                    Minimum="0"
                                    Maximum="240"
                                    SmallChange="5"
                                    LargeChange="15"
                                    TickFrequency="15"
                                    IsSnapToTickEnabled="True"
                                    Value="{Binding RadarMaxFPS, Mode=TwoWay}" />
                            <TextBlock Text="{Binding Value, ElementName=RadarFpsSlider, StringFormat='{}{0:F0}'}"
                                       VerticalAlignment="Center"
                                       Margin="8,0,0,0" />
                        </StackPanel>
                    </WrapPanel>

                    <!-- toggles -->
                    <WrapPanel>
                        <CheckBox Content="显示地图设置助手"
                                  ToolTip="切换“地图设置助手”，以协助获取地图边界/缩放"
                                  IsChecked="{Binding ShowMapSetupHelper, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="瞄准视图小部件"
                                  ToolTip="切换瞄准视图小部件，为您提供雷达窗口的伪ESP。可以移动。"
                                  IsChecked="{Binding AimviewWidget, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="玩家信息小部件"
                                  ToolTip="切换玩家信息小部件，提供关于突袭中玩家/Boss的信息。可以移动。"
                                  IsChecked="{Binding PlayerInfoWidget, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="连接队伍"
                                  ToolTip="通过半透明绿色线连接分组的玩家。不适用于您自己的队伍。"
                                  IsChecked="{Binding ConnectGroups, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="显示地雷"
                                  IsChecked="{Binding ShowHazards, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="队友瞄准线"
                                  ToolTip="启用时使队友的瞄准线与主玩家相同长度。"
                                  IsChecked="{Binding TeammateAimlines, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="AI瞄准线"
                                  ToolTip="为AI玩家启用动态瞄准线。当有人瞄准您时瞄准线会延长。"
                                  IsChecked="{Binding AIAimlines, Mode=TwoWay}"
                                  Margin="0,0,0,8" />
                    </WrapPanel>

                    <!-- Widget Font Size Slider -->
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,8,0,8">
                        <TextBlock Text="小部件字体大小"
                                   VerticalAlignment="Center"
                                   ToolTip="掉落高度指示器(▲▼●)和其他雷达小部件的字体大小。" />
                        <Slider x:Name="WidgetFontSizeSlider"
                                Width="150"
                                Margin="8,0"
                                Minimum="6"
                                Maximum="24"
                                SmallChange="1"
                                LargeChange="2"
                                TickFrequency="1"
                                IsSnapToTickEnabled="True"
                                Value="{Binding RadarWidgetFontSize, Mode=TwoWay}" />
                        <TextBlock Text="{Binding Value, ElementName=WidgetFontSizeSlider, StringFormat='{}{0:F0} px'}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0" />
                    </StackPanel>

                </StackPanel>
            </GroupBox>

            <!-- Loot -->
            <GroupBox Header="掉落"
                      Margin="0,0,0,12">
                <StackPanel>
                    <WrapPanel Margin="0,0,0,8">
                        <CheckBox Content="显示掉落 (F3)"
                                  ToolTip="切换在雷达/ESP上显示掉落。"
                                  IsChecked="{Binding ShowLoot, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                        <CheckBox Content="显示静态容器"
                                  ToolTip="在地图/ESP上显示静态容器。"
                                  IsChecked="{Binding ShowStaticContainers, Mode=TwoWay}"
                                  Margin="0,0,16,8" />
                    </WrapPanel>

                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,16,8"
                                IsEnabled="{Binding ShowStaticContainers}">
                        <TextBlock Text="容器距离"
                                   VerticalAlignment="Center" />
                        <Slider x:Name="ContainerDistSlider"
                                Width="150"
                                Margin="8,0"
                                Minimum="0"
                                Maximum="200"
                                SmallChange="1"
                                LargeChange="10"
                                Value="{Binding ContainerDistance, Mode=TwoWay}" />
                        <TextBlock Text="{Binding Value, ElementName=ContainerDistSlider}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0" />
                    </StackPanel>

                </StackPanel>
            </GroupBox>

            <!-- 任务助手 -->
            <GroupBox Header="任务助手"
                      Margin="0,0,0,12">
                <DockPanel LastChildFill="True"
                           Margin="0,4,0,0">
                    <CheckBox Content="启用"
                              ToolTip="切换任务助手功能。这将显示你当前已激活任务所需拾取的物品和需要访问的区域。"
                              IsChecked="{Binding QuestHelperEnabled, Mode=TwoWay}"
                              DockPanel.Dock="Left"
                              Margin="0,0,8,0" />
                    <ListBox ItemsSource="{Binding CurrentQuests}"
                             IsEnabled="{Binding QuestHelperEnabled}"
                             Height="400"
                             ToolTip="活跃任务列表（进入团队副本后会显示）。取消勾选任务以停止追踪。"
                             ScrollViewer.CanContentScroll="True">

                        <!-- 1) Define the panel *with* virtualization baked in -->
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel VirtualizingStackPanel.IsVirtualizing="True"
                                                        VirtualizingStackPanel.VirtualizationMode="Recycling"
                                                        IsItemsHost="True" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>

                        <!-- 2) Your existing template -->
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <CheckBox Content="{Binding Name}"
                                          IsChecked="{Binding IsEnabled, Mode=TwoWay}" />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </GroupBox>

        </StackPanel>
    </ScrollViewer>
</UserControl>
